<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Affichage</title>
    <link rel="stylesheet" href="style_table.css">
</head>
<body>
    <h2>Table Affichage</h2>
    <div class="table" id="table"></div>
    <br>
    <button onclick="export_en_CSV()">Sauvegarder CSV</button>

    <script>
        // Récupérer les colonnes et les lignes depuis localStorage
        const selectedCols = JSON.parse(localStorage.getItem('selectedColumns')) || [];
        const rows = JSON.parse(localStorage.getItem('rows')) || [];

        // Afficher le tableau
        function afficherTableau() {
            let table = "<table><thead><tr>";
            // Faire des colonnes en tête
            selectedCols.forEach(colIndex => {
                table += `<th>${rows[0][colIndex]}</th>`;
            });
            table += "</tr></thead><tbody>";

            // Des valeurs pour chaque colonne
            for (let i = 1; i < rows.length; i++) {
                table += "<tr>";
                selectedCols.forEach(colIndex => {
                    table += `<td>${rows[i][colIndex]}</td>`;
                });
                table += "</tr>";
            }

            table += "</tbody></table>";
            document.getElementById('table').innerHTML = table;
        }


        // Fonction pour exporter en CSV
        function export_en_CSV() {
            let csvContent = "";
            let table = document.querySelector("table");
            let rows = table.querySelectorAll("tr");

            rows.forEach((row, index) => {
                let rowData = [];
                row.querySelectorAll("th, td").forEach(cell => rowData.push(cell.innerText));
                csvContent += rowData.join(",") + (index < rows.length - 1 ? "\n" : ""); // Ajoute une nouvelle ligne sauf pour la dernière ligne
            });

            let blob = new Blob([csvContent], { type: "text/csv" });
            let link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = "exported_data.csv";    
            link.click();
        }

        // Appeler la fonction pour afficher le tableau
        afficherTableau();
    </script>
</body>
</html>